//路单结构
var list1 = [{
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}]


var list2 = [{
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}]



var list3 = [{
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}]




var list4 = [{
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "小" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}, {
  issue: 1, //期号
  result: "大" //大小单双奇偶
}]



var zoom1 = 0;
$(document).ready(function () {
  var width1 = document.documentElement.clientWidth;
  var width2 = 750;
  if (width1 > 750) {
    width1 = 460
  };
  var zoom = width1 / width2;
  zoom1 = zoom * 100;
  document.querySelector("html").style.fontSize = zoom * 100 + "px";
  document.querySelector("html").style.height = "100%";

  $(".tab>ul>li").click(function () {
    console.log(this);
    $("#content" + $(this).val()).attr('style', 'display:block').siblings("div").attr('style', 'display:none;');
  });

  var startX, startY;
  $(".tab").on("touchstart", function (e) {
    e.preventDefault();
    e.stopPropagation();
    startX = e.originalEvent.changedTouches[0].pageX,
      startY = e.originalEvent.changedTouches[0].pageY;
    console.log(e.originalEvent.changedTouches[0].pageY)
  });
  $(".tab").on("mouserover", function (e) {
    e.preventDefault();
    e.stopPropagation();
    moveEndX = e.originalEvent.changedTouches[0].pageX,
      moveEndY = e.originalEvent.changedTouches[0].pageY,
      X = moveEndX - startX,
      Y = moveEndY - startY;

     console.log(e.target.value+"        fafadsfsdkhsjkdfhgsjkldhbfjkuashdfn,mjsgduajfbnskajgjh")   

    console.log(moveEndY / zoom1 + "rem")
    var arcWith = parseInt(1.03 * zoom1);
    var acrHeight = parseInt(2.28 * zoom1);
    console.log(arcWith + "   " + acrHeight + "  " + moveEndY);
    var index = 0;
    if (0 <= moveEndY && moveEndY < acrHeight / 3) {
      console.log("1")
      index = 1;
    } else if (acrHeight / 3 <= moveEndY && moveEndY < acrHeight * 2 / 3) {
      index = 2;
      console.log("2")
    } else {
      index = 3;
      console.log("3")
    }
    $("#content" + index).attr('style', 'display:block').siblings("div").attr('style', 'display:none;');
  });
  $(".tab").on("touchend", function (e) {


  })

});


























var gridTool = {
  id: "",
  result: "",
  cache: {}, //路单坐标数据
  key: "",
  maxCol: 15, //最大列为16（0-15）
  maxRow: 5, //最大行为6（0-5）
  colWidth: 0.38, //列的宽度,单位rem
  data: {
    lastResult: null, //缓存上一次的结果
    lastCol: 0, //缓存上一列
    lastRow: 0, //缓存上一行
    maxSameResult: 0, //连续开一样的结果有多少期
    turnCol: 0, //记录长注单拐弯时候的列值
    turnRow: 0, //记录长注单拐弯时候的行
  },
  init: function (id, result, key) {
    this.id = id;
    this.key = key;
    this.result = result;
    this.cache[this.key] = [];
    this.data[this.key] = {
      lastResult: null, //缓存上一次的结果
      lastCol: 0, //缓存上一列
      lastRow: 0, //缓存上一行
      maxSameResult: 0, //连续开一样的结果有多少期
      turnCol: 0, //记录长注单拐弯时候的列值
      turnRow: 0, //记录长注单拐弯时候的行
    };
    this.drawTableInMemory();
    for (var i = 0; i < this.result.length; i++) {
      this.newRequest(this.id,this.result[i], this.key);
    }
  },
  drawTableInMemory: function () { //内存中绘制表格位置
    for (var i = 0; i <= this.maxRow; i++) {
      var rows = [];
      for (var j = 0; j <= this.maxCol; j++) {
        rows.push({
          row: i,
          col: j,
          result: ""
        });
      }
      this.cache[this.key].push(rows);
    }
  },
  newRequest: function (id, data, key) {
    this.id = id;
    this.key = key;
    if (this.data[this.key].lastResult !== null) {
      if (this.data[this.key].lastResult.result === data.result) { //eg:上一次开大本次也开大
        if (this.checkNextGridIsInsertInArr(this.data[this.key].lastRow + 1, this.data[this.key].lastCol) && !this.data[this.key].turnCol) {
          this.data[this.key].lastRow = this.data[this.key].lastRow + 1; //同一列行数加1
        } else {
          console.log("===========================================")
            //console.log(checkNextGridIsInsertInArr(lastRow, lastCol + 1) + " " + (lastCol + 1) + "   " + lastRow);

          if (this.checkNextGridIsInsertInArr(this.data[this.key].lastRow, this.data[this.key].lastCol + 1)) { //同行的下一列可以插入数据，水平向右
            this.data[this.key].lastCol = this.data[this.key].lastCol + 1;
            this.data[this.key].lastRow = this.data[this.key].lastRow;
          } else { //不能插入
            //创建新的一列
            //删除第一列
            //平移所有列
            console.log("不能插入数据.............")
            this.cache[this.key] = this.createNewColumn(this.cache[this.key], this.data[this.key].lastCol, this.maxCol, data);
            this.cache[this.key][this.data[this.key].lastRow][this.data[this.key].lastCol + 1].result = data.result;
            this.data[this.key].lastCol = this.data[this.key].lastCol + 1;
            //重新绘制
          }

          if (!this.data[this.key].turnCol || this.data[this.key].turnRow !== this.data[this.key].lastRow) { //路单拐点变化
            this.data[this.key].turnCol = this.data[this.key].lastCol;
            this.data[this.key].turnRow = this.data[this.key].lastRow;
          }
        }
        this.data[this.key].maxSameResult = this.data[this.key].maxSameResult + 1;
      } else { //上一次和本次开的结果不一样，在新列上显示路单

        if (this.data[this.key].turnCol) { //路单存在拐点,在拐点的列的第一个位置插入新的结果
          this.data[this.key].lastCol = this.data[this.key].turnCol;
          this.data[this.key].lastRow = 0;
          this.data[this.key].maxSameResult = 0;
          this.data[this.key].turnCol = "";
        } else {
          this.data[this.key].lastCol = this.data[this.key].lastCol + 1;
          this.data[this.key].lastRow = 0;

        }
      }
    } else { //第一个格子
      this.data[this.key].lastCol = 0;
      this.data[this.key].lastRow = 0;
      this.data[this.key].maxSameResult = 1;
    }
    this.data[this.key].lastResult = data;
    if (this.checkNextGridIsInsertInArr(this.data[this.key].lastRow, this.data[this.key].lastCol)) {
      this.cache[this.key][this.data[this.key].lastRow][this.data[this.key].lastCol].result = data.result;
    }
    this.initTable();
    console.log(this.cache[this.key]);
    //$(".col-" + this.data[this.key].lastCol + ".row-" + this.data[this.key].lastRow + "").html("<div class='grid grid-" + cnToEn(data.result) + "'>" + data.result + "</div>");
    console.log("列：" + this.data[this.key].lastCol + "   行：" + this.data[this.key].lastRow + "  point：" + this.data[this.key].turnCol + "         " + this.data[this.key].maxSameResult)
  },
  checkNextGridIsInsertInArr: function (row, col) { //检查指定格子是否能插入数据
    var flag = false;
    var object;
    try {
      object = this.cache[this.key][row][col];
      flag = true;
    } catch (e) {
      console.log("err")
      flag = false;
    }
    console.log(object);
    console.log("row:=" + row + "   col:=" + col + "  该位置可以插入数据>>>:" + flag);
    if (flag && object != undefined && object.result === "") {
      return true;
    } else {
      return false
    }
  },
  createNewColumn: function (_arr, currentCol, maxCol, data) {
    console.log("???????????????????????" + currentCol + "  " + maxCol)
      // console.log(_arr)
    for (var i = 0; i < _arr.length; i++) {
      _arr[i].push({
        row: i,
        col: currentCol + 1,
        result: ""
      });
    }
    console.log(_arr)
    return _arr;
  },
  initTable: function () {
    var _arr = this.getArr();
    console.log(_arr)
    var table = "";
    for (var i = 0; i < _arr.length; i++) {
      table += "<div class='rows'>";
      for (var j = 0; j < _arr[i].length; j++) {
        if (j % 2 === 0) {
          table += "<div class='column column-even'><div class='grid grid-big retina-border rt-bd-all grid-" + cnToEn(_arr[i][j].result) + "'>" + _arr[i][j].result + "</div></div>";
        } else {
          table += "<div class='column column-odd'><div class='grid grid-big retina-border rt-bd-all grid-" + cnToEn(_arr[i][j].result) + "'>" + _arr[i][j].result + "</div></div>";
        }
      }
      table += "</div>";
    }
    table += "</div>"
    $(this.id).html(table);
  },
  getArr: function () { //获取数组中最后16个元素，因为界面只能显示16列
    var _arr = [];
    for (var k = 0; k < this.cache[this.key].length; k++) {
      var _col = [];
      var dasdsa = this.cache[this.key][k].length - 16;
      for (var m = 0; m < this.cache[this.key][k].length; m++) {
        if (m >= dasdsa) {
          _col.push(this.cache[this.key][k][m]);
        }
      }
      _arr.push(_col)
    }
    return _arr;
  }

}


gridTool.init("#content1", list1, "1")
gridTool.init("#content11", list2, "2")
gridTool.init("#content111", list3, "3")
gridTool.init("#content1111", list4, "4")

function cnToEn(str) {
  var enArr = {
    "大": "big",
    "小": "small"
  };
  return enArr[str];
}
